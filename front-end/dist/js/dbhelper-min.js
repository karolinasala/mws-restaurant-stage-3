class DBHelper{static get DATABASE_URL(){return"http://localhost:1337/restaurants"}static get REVIEWS_URL(){return"http://localhost:1337/reviews"}static fetchRestaurants(e){const t=`${DBHelper.DATABASE_URL}`;fetch(t).then(t=>{200===t.status?t.json().then(t=>{e(null,t)}).catch(t=>{e(t,null)}):e(`Request failed. ${t.status}`,null)}).catch(t=>e(t,null))}static fetchRestaurantById(e,t){DBHelper.fetchRestaurants((a,n)=>{if(a)t(a,null);else{const a=n.find(t=>t.id==e);a?t(null,a):t("Restaurant does not exist",null)}})}static fetchRestaurantByCuisine(e,t){DBHelper.fetchRestaurants((a,n)=>{if(a)t(a,null);else{const a=n.filter(t=>t.cuisine_type==e);t(null,a)}})}static fetchRestaurantByNeighborhood(e,t){DBHelper.fetchRestaurants((a,n)=>{if(a)t(a,null);else{const a=n.filter(t=>t.neighborhood==e);t(null,a)}})}static fetchRestaurantByCuisineAndNeighborhood(e,t,a){DBHelper.fetchRestaurants((n,s)=>{if(n)a(n,null);else{let n=s;"all"!=e&&(n=n.filter(t=>t.cuisine_type==e)),"all"!=t&&(n=n.filter(e=>e.neighborhood==t)),a(null,n)}})}static fetchNeighborhoods(e){DBHelper.fetchRestaurants((t,a)=>{if(t)e(t,null);else{const t=a.map((e,t)=>a[t].neighborhood),n=t.filter((e,a)=>t.indexOf(e)==a);e(null,n)}})}static fetchCuisines(e){DBHelper.fetchRestaurants((t,a)=>{if(t)e(t,null);else{const t=a.map((e,t)=>a[t].cuisine_type),n=t.filter((e,a)=>t.indexOf(e)==a);e(null,n)}})}static fetchFavorite(e,t){let a={is_favorite:t};return fetch(DBHelper.DATABASE_URL+"/"+e+"/",{body:JSON.stringify(a),method:"PUT",headers:new Headers({"Content-Type":"application/json"})}).then(e=>e.ok?e.json():[{}]).then(a=>console.log(`Updated favorite restaurant: ${e} favorite : ${t}`))}static fetchReview(e){const t=`${DBHelper.REVIEWS_URL}`;fetch(t).then(t=>{200===t.status?t.json().then(t=>{e(null,t)}).catch(t=>{e(t,null)}):e(`Request failed. Returned status of ${t.status}`,null)}).catch(t=>e(t,null))}static fetchReviewById(e,t){const a=`${DBHelper.REVIEWS_URL}/?restaurant_id=${e}`;fetch(a).then(e=>{200===e.status?e.json().then(e=>{t(null,e)}).catch(e=>{t(e,null)}):t(`Request failed. Returned status of ${e.status}`,null)}).catch(e=>t(e,null))}static sendReview(e){return new Promise((t,a)=>{fetch(this.REVIEWS_URL,{body:JSON.stringify(e),method:"POST",headers:{"Content-Type":"application/json"}}).then(t).catch(a)})}static cacheReview(e){navigator.online||(window.localStorage.setItem("cache-review-"+e.restaurant_id,JSON.stringify(e)),this.watchReview(e.restaurant_id))}static watchReview(e){navigator.online?this.clearOffline(e):window.addEventListener("online",t=>{null!==window.localStorage.getItem("cache-review-"+e)&&this.clearOffline(e)})}static clearOffline(e){try{this.sendReview(JSON.parse(window.localStorage.getItem("cache-review-"+e))).then(t=>{window.localStorage.removeItem("cache-review-"+e),document.querySelectorAll(".offline").forEach(e=>{e.classList.remove("offline")})}).catch(console.error)}catch(e){console.error(e)}}static urlForRestaurant(e){return`./restaurant.html?id=${e.id}`}static imageUrlForRestaurant(e){return`/img/${e.photograph}.jpg`}static mapMarkerForRestaurant(e,t){return new google.maps.Marker({position:e.latlng,title:e.name,url:DBHelper.urlForRestaurant(e),map:t,animation:google.maps.Animation.DROP})}}
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRiaGVscGVyLmpzIl0sIm5hbWVzIjpbIkRCSGVscGVyIiwiREFUQUJBU0VfVVJMIiwiUkVWSUVXU19VUkwiLCJbb2JqZWN0IE9iamVjdF0iLCJjYWxsYmFjayIsInJlc3RhdXJhbnRzVVJMIiwiZmV0Y2giLCJ0aGVuIiwicmVzcG9uc2UiLCJzdGF0dXMiLCJqc29uIiwiY2F0Y2giLCJlcnJvciIsImlkIiwiZmV0Y2hSZXN0YXVyYW50cyIsInJlc3RhdXJhbnRzIiwicmVzdGF1cmFudCIsImZpbmQiLCJyIiwiY3Vpc2luZSIsInJlc3VsdHMiLCJmaWx0ZXIiLCJjdWlzaW5lX3R5cGUiLCJuZWlnaGJvcmhvb2QiLCJuZWlnaGJvcmhvb2RzIiwibWFwIiwidiIsImkiLCJ1bmlxdWVOZWlnaGJvcmhvb2RzIiwiaW5kZXhPZiIsImN1aXNpbmVzIiwidW5pcXVlQ3Vpc2luZXMiLCJ2YWx1ZSIsImlzX2Zhdm9yaXRlIiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJtZXRob2QiLCJoZWFkZXJzIiwiSGVhZGVycyIsIkNvbnRlbnQtVHlwZSIsIm9rIiwiY29uc29sZSIsImxvZyIsInJldmlld3NVUkwiLCJyZXZpZXciLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsInRoaXMiLCJuYXZpZ2F0b3IiLCJvbmxpbmUiLCJ3aW5kb3ciLCJsb2NhbFN0b3JhZ2UiLCJzZXRJdGVtIiwicmVzdGF1cmFudF9pZCIsIndhdGNoUmV2aWV3IiwiY2xlYXJPZmZsaW5lIiwiYWRkRXZlbnRMaXN0ZW5lciIsImV2ZW50IiwiZ2V0SXRlbSIsInNlbmRSZXZpZXciLCJwYXJzZSIsInJlbW92ZUl0ZW0iLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJmb3JFYWNoIiwiY2xhc3NMaXN0IiwicmVtb3ZlIiwiZSIsInBob3RvZ3JhcGgiLCJnb29nbGUiLCJtYXBzIiwiTWFya2VyIiwicG9zaXRpb24iLCJsYXRsbmciLCJ0aXRsZSIsIm5hbWUiLCJ1cmwiLCJ1cmxGb3JSZXN0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Q0w0QyxPQUFPQyxhQUFhVSxXQUFXLGdCQUFrQmxELEdBQ2pEbUQsU0FBU0MsaUJBQWlCLFlBQVlDLFFBQVFyQixJQUM3Q0EsRUFBT3NCLFVBQVVDLE9BQU8sZUFHekJ6RCxNQUFNK0IsUUFBUTlCLE9BQ2YsTUFBT3lELEdBQ1IzQixRQUFROUIsTUFBTXlELElBT2RsRSx3QkFBd0JhLEdBQ3RCLDhCQUFnQ0EsRUFBV0gsS0FNOUNWLDZCQUE2QmEsR0FDM0IsY0FBZ0JBLEVBQVdzRCxpQkFNN0JuRSw4QkFBOEJhLEVBQVlTLEdBUXhDLE9BUGUsSUFBSThDLE9BQU9DLEtBQUtDLE9BQU8sQ0FDcENDLFNBQVUxRCxFQUFXMkQsT0FDckJDLE1BQU81RCxFQUFXNkQsS0FDbEJDLElBQUs5RSxTQUFTK0UsaUJBQWlCL0QsR0FDL0JTLElBQUtBLEVBQ0x1RCxVQUFXVCxPQUFPQyxLQUFLUyxVQUFVQyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBDb21tb24gZGF0YWJhc2UgaGVscGVyIGZ1bmN0aW9ucy5cclxuICovXHJcbmNsYXNzIERCSGVscGVyIHtcclxuICAvKipcclxuICAgKiBEYXRhYmFzZSBVUkwuXHJcbiAgICogQ2hhbmdlIHRoaXMgdG8gcmVzdGF1cmFudHMuanNvbiBmaWxlIGxvY2F0aW9uIG9uIHlvdXIgc2VydmVyLlxyXG4gICAqL1xyXG4gICBzdGF0aWMgZ2V0IERBVEFCQVNFX1VSTCgpIHtcclxuICAgICBjb25zdCBwb3J0ID0gMTMzNyAvLyBDaGFuZ2UgdGhpcyB0byB5b3VyIHNlcnZlciBwb3J0XHJcbiAgICAgcmV0dXJuIGBodHRwOi8vbG9jYWxob3N0OiR7cG9ydH0vcmVzdGF1cmFudHNgO1xyXG4gICB9XHJcblxyXG4gICBzdGF0aWMgZ2V0IFJFVklFV1NfVVJMKCkge1xyXG4gICAgIGNvbnN0IHBvcnQgPSAxMzM3IC8vIENoYW5nZSB0aGlzIHRvIHlvdXIgc2VydmVyIHBvcnRcclxuICAgICByZXR1cm4gYGh0dHA6Ly9sb2NhbGhvc3Q6JHtwb3J0fS9yZXZpZXdzYDtcclxuICAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCBhbGwgcmVzdGF1cmFudHMuXHJcbiAgICovXHJcbiAgIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRzKGNhbGxiYWNrKSB7XHJcbiAgICBjb25zdCByZXN0YXVyYW50c1VSTCA9IGAke0RCSGVscGVyLkRBVEFCQVNFX1VSTH1gO1xyXG4gICAgZmV0Y2gocmVzdGF1cmFudHNVUkwpXHJcbiAgICAgIC50aGVuKHJlc3BvbnNlID0+IHtcclxuICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSAyMDApIHtcclxuICAgICAgICAgIHJlc3BvbnNlLmpzb24oKVxyXG4gICAgICAgICAgICAudGhlbihqc29uID0+IHtcclxuICAgICAgICAgICAgICBjYWxsYmFjayhudWxsLCBqc29uKTtcclxuICAgICAgICAgICAgfSkuY2F0Y2goZXJyb3IgPT4ge1xyXG4gICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIGNhbGxiYWNrKChgUmVxdWVzdCBmYWlsZWQuICR7cmVzcG9uc2Uuc3RhdHVzfWApLCBudWxsKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgICAgKS5jYXRjaChlcnJvciA9PiBjYWxsYmFjayhlcnJvciwgbnVsbCkpO1xyXG4gIH1cclxuICAvKipcclxuICAgKiBGZXRjaCBhIHJlc3RhdXJhbnQgYnkgaXRzIElELlxyXG4gICAqL1xyXG4gICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50QnlJZChpZCwgY2FsbGJhY2spIHtcclxuICAgICAvLyBmZXRjaCBhbGwgcmVzdGF1cmFudHMgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xyXG4gICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgY29uc3QgcmVzdGF1cmFudCA9IHJlc3RhdXJhbnRzLmZpbmQociA9PiByLmlkID09IGlkKTtcclxuICAgICAgICAgaWYgKHJlc3RhdXJhbnQpIHsgLy8gR290IHRoZSByZXN0YXVyYW50XHJcbiAgICAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdGF1cmFudCk7XHJcbiAgICAgICAgIH0gZWxzZSB7IC8vIFJlc3RhdXJhbnQgZG9lcyBub3QgZXhpc3QgaW4gdGhlIGRhdGFiYXNlXHJcbiAgICAgICAgICAgY2FsbGJhY2soJ1Jlc3RhdXJhbnQgZG9lcyBub3QgZXhpc3QnLCBudWxsKTtcclxuICAgICAgICAgfVxyXG4gICAgICAgfVxyXG4gICAgIH0pO1xyXG4gICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIHJlc3RhdXJhbnRzIGJ5IGEgY3Vpc2luZSB0eXBlIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAqL1xyXG4gICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50QnlDdWlzaW5lKGN1aXNpbmUsIGNhbGxiYWNrKSB7XHJcbiAgICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzICB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZ1xyXG4gICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xyXG4gICAgICAgaWYgKGVycm9yKSB7XHJcbiAgICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcclxuICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgIC8vIEZpbHRlciByZXN0YXVyYW50cyB0byBoYXZlIG9ubHkgZ2l2ZW4gY3Vpc2luZSB0eXBlXHJcbiAgICAgICAgIGNvbnN0IHJlc3VsdHMgPSByZXN0YXVyYW50cy5maWx0ZXIociA9PiByLmN1aXNpbmVfdHlwZSA9PSBjdWlzaW5lKTtcclxuICAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdWx0cyk7XHJcbiAgICAgICB9XHJcbiAgICAgfSk7XHJcbiAgIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggcmVzdGF1cmFudHMgYnkgYSBuZWlnaGJvcmhvb2Qgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICovXHJcbiAgIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRCeU5laWdoYm9yaG9vZChuZWlnaGJvcmhvb2QsIGNhbGxiYWNrKSB7XHJcbiAgICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzXHJcbiAgICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xyXG4gICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgLy8gRmlsdGVyIHJlc3RhdXJhbnRzIHRvIGhhdmUgb25seSBnaXZlbiBuZWlnaGJvcmhvb2RcclxuICAgICAgICAgY29uc3QgcmVzdWx0cyA9IHJlc3RhdXJhbnRzLmZpbHRlcihyID0+IHIubmVpZ2hib3Job29kID09IG5laWdoYm9yaG9vZCk7XHJcbiAgICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3VsdHMpO1xyXG4gICAgICAgfVxyXG4gICAgIH0pO1xyXG4gICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIHJlc3RhdXJhbnRzIGJ5IGEgY3Vpc2luZSBhbmQgYSBuZWlnaGJvcmhvb2Qgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICovXHJcbiAgIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmVBbmROZWlnaGJvcmhvb2QoY3Vpc2luZSwgbmVpZ2hib3Job29kLCBjYWxsYmFjaykge1xyXG4gICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xyXG4gICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xyXG4gICAgICAgaWYgKGVycm9yKSB7XHJcbiAgICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcclxuICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgIGxldCByZXN1bHRzID0gcmVzdGF1cmFudHNcclxuICAgICAgICAgaWYgKGN1aXNpbmUgIT0gJ2FsbCcpIHsgLy8gZmlsdGVyIGJ5IGN1aXNpbmVcclxuICAgICAgICAgICByZXN1bHRzID0gcmVzdWx0cy5maWx0ZXIociA9PiByLmN1aXNpbmVfdHlwZSA9PSBjdWlzaW5lKTtcclxuICAgICAgICAgfVxyXG4gICAgICAgICBpZiAobmVpZ2hib3Job29kICE9ICdhbGwnKSB7IC8vIGZpbHRlciBieSBuZWlnaGJvcmhvb2RcclxuICAgICAgICAgICByZXN1bHRzID0gcmVzdWx0cy5maWx0ZXIociA9PiByLm5laWdoYm9yaG9vZCA9PSBuZWlnaGJvcmhvb2QpO1xyXG4gICAgICAgICB9XHJcbiAgICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3VsdHMpO1xyXG4gICAgICAgfVxyXG4gICAgIH0pO1xyXG4gICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIGFsbCBuZWlnaGJvcmhvb2RzIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAqL1xyXG4gICBzdGF0aWMgZmV0Y2hOZWlnaGJvcmhvb2RzKGNhbGxiYWNrKSB7XHJcbiAgICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzXHJcbiAgICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xyXG4gICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgLy8gR2V0IGFsbCBuZWlnaGJvcmhvb2RzIGZyb20gYWxsIHJlc3RhdXJhbnRzXHJcbiAgICAgICAgIGNvbnN0IG5laWdoYm9yaG9vZHMgPSByZXN0YXVyYW50cy5tYXAoKHYsIGkpID0+IHJlc3RhdXJhbnRzW2ldLm5laWdoYm9yaG9vZClcclxuICAgICAgICAgLy8gUmVtb3ZlIGR1cGxpY2F0ZXMgZnJvbSBuZWlnaGJvcmhvb2RzXHJcbiAgICAgICAgIGNvbnN0IHVuaXF1ZU5laWdoYm9yaG9vZHMgPSBuZWlnaGJvcmhvb2RzLmZpbHRlcigodiwgaSkgPT4gbmVpZ2hib3Job29kcy5pbmRleE9mKHYpID09IGkpXHJcbiAgICAgICAgIGNhbGxiYWNrKG51bGwsIHVuaXF1ZU5laWdoYm9yaG9vZHMpO1xyXG4gICAgICAgfVxyXG4gICAgIH0pO1xyXG4gICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIGFsbCBjdWlzaW5lcyB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuICAgKi9cclxuICAgc3RhdGljIGZldGNoQ3Vpc2luZXMoY2FsbGJhY2spIHtcclxuICAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcclxuICAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcclxuICAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XHJcbiAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAvLyBHZXQgYWxsIGN1aXNpbmVzIGZyb20gYWxsIHJlc3RhdXJhbnRzXHJcbiAgICAgICAgIGNvbnN0IGN1aXNpbmVzID0gcmVzdGF1cmFudHMubWFwKCh2LCBpKSA9PiByZXN0YXVyYW50c1tpXS5jdWlzaW5lX3R5cGUpXHJcbiAgICAgICAgIC8vIFJlbW92ZSBkdXBsaWNhdGVzIGZyb20gY3Vpc2luZXNcclxuICAgICAgICAgY29uc3QgdW5pcXVlQ3Vpc2luZXMgPSBjdWlzaW5lcy5maWx0ZXIoKHYsIGkpID0+IGN1aXNpbmVzLmluZGV4T2YodikgPT0gaSlcclxuICAgICAgICAgY2FsbGJhY2sobnVsbCwgdW5pcXVlQ3Vpc2luZXMpO1xyXG4gICAgICAgfVxyXG4gICAgIH0pO1xyXG4gICB9XHJcblxyXG4gICAvKipcclxuICAgKiBSZXN0YXVyYW50IGZhdm9yaXRlXHJcbiAgICovXHJcbiAgIHN0YXRpYyBmZXRjaEZhdm9yaXRlKGlkLCB2YWx1ZSl7XHJcbiAgICAgbGV0IGlzX2Zhdm9yaXRlID0ge1xyXG4gICAgICAgXCJpc19mYXZvcml0ZVwiOiB2YWx1ZVxyXG4gICAgIH07XHJcblxyXG4gICAgIHJldHVybiBmZXRjaChEQkhlbHBlci5EQVRBQkFTRV9VUkwrJy8nK2lkKycvJywge1xyXG4gICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoaXNfZmF2b3JpdGUpLFxyXG4gICAgICAgbWV0aG9kOiAnUFVUJyxcclxuICAgICAgIGhlYWRlcnM6IG5ldyBIZWFkZXJzKHtcclxuXHRcdFx0XHQnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nXHJcblx0XHRcdH0pXHJcbiAgICAgfSlcclxuICAgICAudGhlbihyZXNwb25zZSA9PiB7XHJcbiAgICAgICBpZihyZXNwb25zZS5vaykge1xyXG4gICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKTtcclxuICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICByZXR1cm4gW3t9XTtcclxuICAgICAgIH1cclxuICAgICB9KVxyXG4gICAgIC50aGVuKHJlc3BvbnNlID0+IGNvbnNvbGUubG9nKGBVcGRhdGVkIGZhdm9yaXRlIHJlc3RhdXJhbnQ6ICR7aWR9IGZhdm9yaXRlIDogJHt2YWx1ZX1gKSk7XHJcbiAgIH1cclxuXHJcbiAgIC8qKlxyXG4gICAgKiBGZXRjaCBhbGwgcmV2aWV3cy5cclxuICAgICovXHJcbiAgICBzdGF0aWMgZmV0Y2hSZXZpZXcoY2FsbGJhY2spIHtcclxuICAgICBjb25zdCByZXZpZXdzVVJMID0gYCR7REJIZWxwZXIuUkVWSUVXU19VUkx9YDtcclxuICAgICBmZXRjaChyZXZpZXdzVVJMKVxyXG4gICAgICAgLnRoZW4ocmVzcG9uc2UgPT4ge1xyXG4gICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDIwMCkge1xyXG4gICAgICAgICAgICAgcmVzcG9uc2UuanNvbigpXHJcbiAgICAgICAgICAgICAgIC50aGVuKGpzb24gPT4ge1xyXG4gICAgICAgICAgICAgICAgIGNhbGxiYWNrKG51bGwsIGpzb24pO1xyXG4gICAgICAgICAgICAgICAgIHJldHVyblxyXG4gICAgICAgICAgICAgICB9KS5jYXRjaChlcnJvciA9PiB7XHJcbiAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKVxyXG4gICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgIGNhbGxiYWNrKChgUmVxdWVzdCBmYWlsZWQuIFJldHVybmVkIHN0YXR1cyBvZiAke3Jlc3BvbnNlLnN0YXR1c31gKSwgbnVsbCk7XHJcbiAgICAgICAgICAgfVxyXG4gICAgICAgICB9XHJcbiAgICAgICApLmNhdGNoKGVycm9yID0+IGNhbGxiYWNrKGVycm9yLCBudWxsKSk7XHJcbiAgIH1cclxuXHJcbiAgIC8qKlxyXG4gICAqIEZldGNoIGEgcmV2aWV3IGJ5IHJlc3RhdXJhbnQgaWQuXHJcbiAgICovXHJcbiAgIHN0YXRpYyBmZXRjaFJldmlld0J5SWQoaWQsIGNhbGxiYWNrKSB7XHJcbiAgICAgY29uc3QgcmV2aWV3c1VSTCA9IGAke0RCSGVscGVyLlJFVklFV1NfVVJMfS8/cmVzdGF1cmFudF9pZD0ke2lkfWA7XHJcbiAgICAgZmV0Y2gocmV2aWV3c1VSTClcclxuICAgICAgIC50aGVuKHJlc3BvbnNlID0+IHtcclxuICAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSAyMDApIHtcclxuICAgICAgICAgICAgIHJlc3BvbnNlLmpzb24oKVxyXG4gICAgICAgICAgICAgICAudGhlbihqc29uID0+IHtcclxuICAgICAgICAgICAgICAgICBjYWxsYmFjayhudWxsLCBqc29uKTtcclxuICAgICAgICAgICAgICAgICByZXR1cm5cclxuICAgICAgICAgICAgICAgfSkuY2F0Y2goZXJyb3IgPT4ge1xyXG4gICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbClcclxuICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICBjYWxsYmFjaygoYFJlcXVlc3QgZmFpbGVkLiBSZXR1cm5lZCBzdGF0dXMgb2YgJHtyZXNwb25zZS5zdGF0dXN9YCksIG51bGwpO1xyXG4gICAgICAgICAgIH1cclxuICAgICAgICAgfVxyXG4gICAgICAgKS5jYXRjaChlcnJvciA9PiBjYWxsYmFjayhlcnJvciwgbnVsbCkpO1xyXG4gICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFBvc3QgcmV2aWV3c1xyXG4gICovXHJcbiAgc3RhdGljIHNlbmRSZXZpZXcocmV2aWV3KSB7XHJcbiAgXHRcdHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgXHRcdFx0ZmV0Y2godGhpcy5SRVZJRVdTX1VSTCwge1xyXG4gIFx0XHRcdFx0Ym9keTogSlNPTi5zdHJpbmdpZnkocmV2aWV3KSxcclxuICAgICAgICAgIG1ldGhvZDogXCJQT1NUXCIsXHJcbiAgXHRcdFx0XHRoZWFkZXJzOiB7XHJcbiAgXHRcdFx0XHRcdFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiXHJcbiAgXHRcdFx0XHR9XHJcbiAgXHRcdFx0fSlcclxuICBcdFx0XHRcdC50aGVuKHJlc29sdmUpXHJcbiAgXHRcdFx0XHQuY2F0Y2gocmVqZWN0KTtcclxuICBcdFx0fSlcclxuICBcdH1cclxuXHJcbiAgc3RhdGljIGNhY2hlUmV2aWV3KHJldmlldykge1xyXG5cdFx0aWYgKCFuYXZpZ2F0b3Iub25saW5lKSB7XHJcblx0XHRcdHdpbmRvdy5sb2NhbFN0b3JhZ2Uuc2V0SXRlbShcImNhY2hlLXJldmlldy1cIiArIHJldmlldy5yZXN0YXVyYW50X2lkLCBKU09OLnN0cmluZ2lmeShyZXZpZXcpKTtcclxuXHRcdFx0dGhpcy53YXRjaFJldmlldyhyZXZpZXcucmVzdGF1cmFudF9pZCk7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuICBzdGF0aWMgd2F0Y2hSZXZpZXcoaWQpIHtcclxuXHRcdGlmICghbmF2aWdhdG9yLm9ubGluZSkge1xyXG5cdFx0XHR3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcIm9ubGluZVwiLCBldmVudCA9PiB7XHJcblx0XHRcdFx0aWYgKHdpbmRvdy5sb2NhbFN0b3JhZ2UuZ2V0SXRlbShcImNhY2hlLXJldmlldy1cIiArIGlkKSAhPT0gbnVsbCkge1xyXG5cdFx0XHRcdFx0dGhpcy5jbGVhck9mZmxpbmUoaWQpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fSk7XHJcblx0XHR9IGVsc2Uge1xyXG5cdFx0XHR0aGlzLmNsZWFyT2ZmbGluZShpZCk7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHRzdGF0aWMgY2xlYXJPZmZsaW5lKGlkKSB7XHJcblx0XHR0cnkge1xyXG5cdFx0XHR0aGlzLnNlbmRSZXZpZXcoSlNPTi5wYXJzZSh3aW5kb3cubG9jYWxTdG9yYWdlLmdldEl0ZW0oXCJjYWNoZS1yZXZpZXctXCIgKyBpZCkpKVxyXG5cdFx0XHRcdC50aGVuKHJlc3BvbnNlID0+IHtcclxuXHRcdFx0XHRcdHdpbmRvdy5sb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShcImNhY2hlLXJldmlldy1cIiArIGlkKTtcclxuXHRcdFx0XHRcdGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIub2ZmbGluZVwiKS5mb3JFYWNoKHJldmlldyA9PiB7XHJcblx0XHRcdFx0XHRcdHJldmlldy5jbGFzc0xpc3QucmVtb3ZlKFwib2ZmbGluZVwiKTtcclxuXHRcdFx0XHRcdH0pO1xyXG5cdFx0XHRcdH0pXHJcblx0XHRcdFx0LmNhdGNoKGNvbnNvbGUuZXJyb3IpO1xyXG5cdFx0fSBjYXRjaCAoZSkge1xyXG5cdFx0XHRjb25zb2xlLmVycm9yKGUpO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmVzdGF1cmFudCBwYWdlIFVSTC5cclxuICAgKi9cclxuICAgc3RhdGljIHVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCkge1xyXG4gICAgIHJldHVybiAoYC4vcmVzdGF1cmFudC5odG1sP2lkPSR7cmVzdGF1cmFudC5pZH1gKTtcclxuICAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXN0YXVyYW50IGltYWdlIFVSTC5cclxuICAgKi9cclxuICBzdGF0aWMgaW1hZ2VVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpIHtcclxuICAgIHJldHVybiAoYC9pbWcvJHtyZXN0YXVyYW50LnBob3RvZ3JhcGh9LmpwZ2ApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogTWFwIG1hcmtlciBmb3IgYSByZXN0YXVyYW50LlxyXG4gICAqL1xyXG4gIHN0YXRpYyBtYXBNYXJrZXJGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQsIG1hcCkge1xyXG4gICAgY29uc3QgbWFya2VyID0gbmV3IGdvb2dsZS5tYXBzLk1hcmtlcih7XHJcbiAgICAgIHBvc2l0aW9uOiByZXN0YXVyYW50LmxhdGxuZyxcclxuICAgICAgdGl0bGU6IHJlc3RhdXJhbnQubmFtZSxcclxuICAgICAgdXJsOiBEQkhlbHBlci51cmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpLFxyXG4gICAgICBtYXA6IG1hcCxcclxuICAgICAgYW5pbWF0aW9uOiBnb29nbGUubWFwcy5BbmltYXRpb24uRFJPUH1cclxuICAgICk7XHJcbiAgICByZXR1cm4gbWFya2VyO1xyXG4gIH1cclxuXHJcbn1cclxuIl0sImZpbGUiOiJkYmhlbHBlci1taW4uanMifQ==
